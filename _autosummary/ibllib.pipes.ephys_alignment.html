

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ibllib.pipes.ephys_alignment &mdash; IBL Library  documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/style.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/language_data.js"></script>
        <script src="../_static/clipboard.min.js"></script>
        <script src="../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="ibllib.pipes.ephys_preprocessing" href="ibllib.pipes.ephys_preprocessing.html" />
    <link rel="prev" title="ibllib.pipes" href="ibllib.pipes.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home" alt="Documentation Home"> IBL Library
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../01_overview.html">IBL data structure</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../02_installation.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../03_one.html">ONE</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../04_alf.html">Alyx Files (ALF)</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../05_datajoint.html">Datajoint</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../06_examples.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../07_tutorials.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../08_public.html">IBL Public Data</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../09_contribution.html">Contribution Statement</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../010_api_reference.html">API Reference</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="one.html">one</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="ibllib.html">ibllib</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="ibllib.atlas.html">ibllib.atlas</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.dsp.html">ibllib.dsp</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.ephys.html">ibllib.ephys</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.exceptions.html">ibllib.exceptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.graphic.html">ibllib.graphic</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.io.html">ibllib.io</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.misc.html">ibllib.misc</a></li>
<li class="toctree-l3 current"><a class="reference internal" href="ibllib.pipes.html">ibllib.pipes</a><ul class="current">
<li class="toctree-l4 current"><a class="current reference internal" href="#">ibllib.pipes.ephys_alignment</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.ephys_preprocessing.html">ibllib.pipes.ephys_preprocessing</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.histology.html">ibllib.pipes.histology</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.local_server.html">ibllib.pipes.local_server</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.misc.html">ibllib.pipes.misc</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.purge_rig_data.html">ibllib.pipes.purge_rig_data</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.remote_server.html">ibllib.pipes.remote_server</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.scan_fix_passive_files.html">ibllib.pipes.scan_fix_passive_files</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.tasks.html">ibllib.pipes.tasks</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.training_preprocessing.html">ibllib.pipes.training_preprocessing</a></li>
<li class="toctree-l4"><a class="reference internal" href="ibllib.pipes.transfer_rig_data.html">ibllib.pipes.transfer_rig_data</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.plots.html">ibllib.plots</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.qc.html">ibllib.qc</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.tests.html">ibllib.tests</a></li>
<li class="toctree-l3"><a class="reference internal" href="ibllib.time.html">ibllib.time</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="brainbox.html">brainbox</a></li>
</ul>
</li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">IBL Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../010_api_reference.html">API Reference</a> &raquo;</li>
        
          <li><a href="ibllib.html">ibllib</a> &raquo;</li>
        
          <li><a href="ibllib.pipes.html">ibllib.pipes</a> &raquo;</li>
        
      <li>ibllib.pipes.ephys_alignment</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="../_sources/_autosummary/ibllib.pipes.ephys_alignment.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast.container,
.nboutput.nblast.container {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast.container + .nbinput.container {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}

/* Fix math alignment, see https://github.com/rtfd/sphinx_rtd_theme/pull/686 */
.math {
    text-align: unset;
}
</style>
<div class="section" id="module-ibllib.pipes.ephys_alignment">
<span id="ibllib-pipes-ephys-alignment"></span><h1>ibllib.pipes.ephys_alignment<a class="headerlink" href="#module-ibllib.pipes.ephys_alignment" title="Permalink to this headline">Â¶</a></h1>
<p class="rubric">Functions</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.pipes.ephys_alignment._cumulative_distance" title="ibllib.pipes.ephys_alignment._cumulative_distance"><code class="xref py py-obj docutils literal notranslate"><span class="pre">_cumulative_distance</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<p class="rubric">Classes</p>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
<tr class="row-odd"><td><p><a class="reference internal" href="#ibllib.pipes.ephys_alignment.EphysAlignment" title="ibllib.pipes.ephys_alignment.EphysAlignment"><code class="xref py py-obj docutils literal notranslate"><span class="pre">EphysAlignment</span></code></a></p></td>
<td><p></p></td>
</tr>
</tbody>
</table>
<dl class="py function">
<dt id="ibllib.pipes.ephys_alignment._cumulative_distance">
<code class="sig-name descname">_cumulative_distance</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xyz</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#_cumulative_distance"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment._cumulative_distance" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="py class">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment">
<em class="property">class </em><code class="sig-name descname">EphysAlignment</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xyz_picks</span></em>, <em class="sig-param"><span class="n">chn_depths</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">track_prev</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">feature_prev</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">brain_atlas</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">speedy</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">object</span></code></p>
<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.__init__">
<code class="sig-name descname">__init__</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xyz_picks</span></em>, <em class="sig-param"><span class="n">chn_depths</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">track_prev</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">feature_prev</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">brain_atlas</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">speedy</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.__init__"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.__init__" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Initialize self.  See help(type(self)) for accurate signature.</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.get_insertion_track">
<code class="sig-name descname">get_insertion_track</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xyz_picks</span></em>, <em class="sig-param"><span class="n">speedy</span><span class="o">=</span><span class="default_value">False</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_insertion_track"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_insertion_track" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Extends probe trajectory from bottom of brain to upper bound of allen atlas
:param xyz_picks: points defining probe trajectory in 3D space (xyz)
:type xyz_picks: np.array((n, 3)) - n: no. of unique points
:return xyz_track: points defining extended trajectory in 3D space (xyz)
:type xyz_track: np.array((n+2, 3))
:return track_extent: cumulative distance between two extremes of xyz_track (bottom of
brain and top of atlas) offset by distance to probe tip
:type track_extent: np.array((2))</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.get_track_and_feature">
<code class="sig-name descname">get_track_and_feature</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_track_and_feature"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_track_and_feature" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Return track, feature and xyz_track variables</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.feature2track">
<em class="property">static </em><code class="sig-name descname">feature2track</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">trk</span></em>, <em class="sig-param"><span class="n">feature</span></em>, <em class="sig-param"><span class="n">track</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.feature2track"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.feature2track" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Estimate new values of trk according to interpolated fit between feature and track space
:param trk: points in track space to convert feature space
:type trk: np.array
:param feature: reference coordinates in feature space (ephys plots)
:type feature: np.array((n_lines + 2)) n_lines: no. of user reference lines
:param track: reference coordinates in track space (histology track)
:type track: np.array((n_lines + 2))
:return fcn(trk): interpolated values of trk
:type fcn(trk): np.array</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.track2feature">
<em class="property">static </em><code class="sig-name descname">track2feature</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">ft</span></em>, <em class="sig-param"><span class="n">feature</span></em>, <em class="sig-param"><span class="n">track</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.track2feature"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.track2feature" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Estimate new values of ft according to interpolated fit between track and feature space
:param ft: points in feature space to convert track space
:type ft: np.array
:param feature: reference coordinates in feature space (ephys plots)
:type feature: np.array((n_lines + 2)) n_lines: no. of user reference lines
:param track: reference coordinates in track space (histology track)
:type track: np.array((n_lines + 2))
:return fcn(ft): interpolated values of ft
:type fcn(ft): np.array</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.feature2track_lin">
<em class="property">static </em><code class="sig-name descname">feature2track_lin</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">trk</span></em>, <em class="sig-param"><span class="n">feature</span></em>, <em class="sig-param"><span class="n">track</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.feature2track_lin"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.feature2track_lin" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Estimate new values of trk according to linear fit between feature and track space, only
implemented if no. of reference points &gt;= 3
:param trk: points in track space to convert feature space
:type trk: np.array
:param feature: reference coordinates in feature space (ephys plots)
:type feature: np.array((n_lines + 2)) n_lines: no. of user reference lines
:param track: reference coordinates in track space (histology track)
:type track: np.array((n_lines + 2))
:return fcn(trk): linear fit values of trk
:type fcn(trk): np.array</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.adjust_extremes_uniform">
<em class="property">static </em><code class="sig-name descname">adjust_extremes_uniform</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">feature</span></em>, <em class="sig-param"><span class="n">track</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.adjust_extremes_uniform"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.adjust_extremes_uniform" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Change the value of the first and last reference points (non user chosen points) such
that coordinates outside user picked regions are left unchanged
:param feature: reference coordinates in feature space (ephys plots)
:type feature: np.array((n_lines + 2)) n_lines: no. of user reference lines
:param track: reference coordinates in track space (histology track)
:type track: np.array((n_lines + 2))
:return track: reference coordinates in track space with first and last value adjusted
:type track: np.array((n_lines + 2))</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.adjust_extremes_linear">
<code class="sig-name descname">adjust_extremes_linear</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">feature</span></em>, <em class="sig-param"><span class="n">track</span></em>, <em class="sig-param"><span class="n">extend_feature</span><span class="o">=</span><span class="default_value">1</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.adjust_extremes_linear"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.adjust_extremes_linear" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Change the value of the first and last reference points (non user chosen points) such
that coordinates outside user picked regions have a linear fit applied
:param feature: reference coordinates in feature space (ephys plots)
:type feature: np.array((n_lines + 2)) n_lines: no. of user reference lines
:param track: reference coordinates in track space (histology track)
:type track: np.array((n_lines + 2))
:param extend_feature: amount to extend extreme coordinates before applying linear fit
:type extend_feature: float
:return feature: reference coordinates in feature space with first and last value adjusted
:type feature: np.array((n_lines + 2))
:return track: reference coordinates in track space with first and last value adjusted
:type track: np.array((n_lines + 2))</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.scale_histology_regions">
<code class="sig-name descname">scale_histology_regions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">feature</span></em>, <em class="sig-param"><span class="n">track</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.scale_histology_regions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.scale_histology_regions" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Recompute locations of brain region boundaries using interpolated fit based on reference
lines
:param feature: reference coordinates in feature space (ephys plots)
:type feature: np.array((n_lines + 2)) n_lines: no. of user reference lines
:param track: reference coordinates in track space (histology track)
:type track: np.array((n_lines + 2))
:return region: new coordinates of histology boundaries after applying interpolation
:type region: np.array((n_bound, 2)) n_bound: no. of histology boundaries
:return region_label: new coordinates of histology labels positions after applying</p>
<blockquote>
<div><p>interpolation</p>
</div></blockquote>
<dl class="field-list simple">
</dl>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.get_histology_regions">
<em class="property">static </em><code class="sig-name descname">get_histology_regions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xyz_coords</span></em>, <em class="sig-param"><span class="n">depth_coords</span></em>, <em class="sig-param"><span class="n">brain_atlas</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">mapping</span><span class="o">=</span><span class="default_value">'Allen'</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_histology_regions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_histology_regions" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Find all brain regions and their boundaries along the depth of probe or track
:param xyz_coords: 3D coordinates of points along probe or track
:type xyz_coords: np.array((n_points, 3)) n_points: no. of points
:param depth_coords: depth along probe or track where each xyz_coord is located
:type depth_coords: np.array((n_points))
:return region: coordinates bounding each brain region
:type region: np.array((n_bound, 2)) n_bound: no. of histology boundaries
:return region_label: label for each brain region and coordinate of where to place label
:type region_label: np.array((n_bound)) of tuples (coordinate - float, label - str)
:return region_colour: allen atlas rgb colour for each brain region along track
:type region_colour: np.array((n_bound, 3))
:return region_id: allen atlas id for each brain region along track
:type region_id: np.array((n_bound))</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.get_nearest_boundary">
<em class="property">static </em><code class="sig-name descname">get_nearest_boundary</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xyz_coords</span></em>, <em class="sig-param"><span class="n">allen</span></em>, <em class="sig-param"><span class="n">extent</span><span class="o">=</span><span class="default_value">100</span></em>, <em class="sig-param"><span class="n">steps</span><span class="o">=</span><span class="default_value">8</span></em>, <em class="sig-param"><span class="n">parent</span><span class="o">=</span><span class="default_value">True</span></em>, <em class="sig-param"><span class="n">brain_atlas</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_nearest_boundary"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_nearest_boundary" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Finds distance to closest neighbouring brain region along trajectory. For each point in
xyz_coords computes the plane passing through point and perpendicular to trajectory and
finds all brain regions that lie in that plane up to a given distance extent from specified
point. Additionally, if requested, computes distance between the parents of regions.
:param xyz_coords: 3D coordinates of points along probe or track
:type xyz_coords: np.array((n_points, 3)) n_points: no. of points
:param allen: dataframe containing allen info. Loaded from allen_structure_tree in
ibllib/atlas
:type allen: pandas Dataframe
:param extent: extent of plane in each direction from origin in (um)
:type extent: float
:param steps: no. of steps to discretise plane into
:type steps: int
:param parent: Whether to also compute nearest distance between parents of regions
:type parent: bool
:return nearest_bound: dict containing results
:type nearest_bound: dict</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.arrange_into_regions">
<em class="property">static </em><code class="sig-name descname">arrange_into_regions</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">depth_coords</span></em>, <em class="sig-param"><span class="n">region_ids</span></em>, <em class="sig-param"><span class="n">distance</span></em>, <em class="sig-param"><span class="n">region_colours</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.arrange_into_regions"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.arrange_into_regions" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Arrange output from get_nearest_boundary into a form that can be plot using pyqtgraph or
matplotlib
:param depth_coords: depth along probe or track where each point is located
:type depth_coords: np.array((n_points))
:param region_ids: brain region id at each depth along probe
:type regions_ids: np.array((n_points))
:param distance: distance to nearest boundary in plane at each point
:type distance: np.array((n_points))
:param region_colours: allen atlas hex colour for each region id
:type region_colours: list of strings len(n_points)
:return all_x: dist values for each region along probe track
:type all_x: list of np.array
:return all_y: depth values for each region along probe track
:type all_y: list of np.array
:return all_colour: colour assigned to each region along probe track
:type all_colour: list of str</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.get_scale_factor">
<code class="sig-name descname">get_scale_factor</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">region</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_scale_factor"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_scale_factor" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Find how much each brain region has been scaled following interpolation
:param region: scaled histology boundaries
:type region: np.array((n_bound, 2)) n_bound: no. of histology boundaries
:return scaled_region: regions that have unique scaling applied
:type scaled_region: np.array((n_scale, 2)) n_scale: no. of uniquely scaled regions
:return scale_factor: scale factor applied to each scaled region
:type scale_factor: np.array((n_scale))</p>
</dd></dl>

<dl class="py attribute">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.__dict__">
<code class="sig-name descname">__dict__</code><em class="property"> = mappingproxy({'__module__': 'ibllib.pipes.ephys_alignment', '__init__': &lt;function EphysAlignment.__init__&gt;, 'get_insertion_track': &lt;function EphysAlignment.get_insertion_track&gt;, 'get_track_and_feature': &lt;function EphysAlignment.get_track_and_feature&gt;, 'feature2track': &lt;staticmethod object&gt;, 'track2feature': &lt;staticmethod object&gt;, 'feature2track_lin': &lt;staticmethod object&gt;, 'adjust_extremes_uniform': &lt;staticmethod object&gt;, 'adjust_extremes_linear': &lt;function EphysAlignment.adjust_extremes_linear&gt;, 'scale_histology_regions': &lt;function EphysAlignment.scale_histology_regions&gt;, 'get_histology_regions': &lt;staticmethod object&gt;, 'get_nearest_boundary': &lt;staticmethod object&gt;, 'arrange_into_regions': &lt;staticmethod object&gt;, 'get_scale_factor': &lt;function EphysAlignment.get_scale_factor&gt;, 'get_channel_locations': &lt;function EphysAlignment.get_channel_locations&gt;, 'get_brain_locations': &lt;function EphysAlignment.get_brain_locations&gt;, 'get_perp_vector': &lt;function EphysAlignment.get_perp_vector&gt;, '__dict__': &lt;attribute '__dict__' of 'EphysAlignment' objects&gt;, '__weakref__': &lt;attribute '__weakref__' of 'EphysAlignment' objects&gt;, '__doc__': None})</em><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.__dict__" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.__doc__">
<code class="sig-name descname">__doc__</code><em class="property"> = None</em><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.__doc__" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.__module__">
<code class="sig-name descname">__module__</code><em class="property"> = 'ibllib.pipes.ephys_alignment'</em><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.__module__" title="Permalink to this definition">Â¶</a></dt>
<dd></dd></dl>

<dl class="py attribute">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.__weakref__">
<code class="sig-name descname">__weakref__</code><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.__weakref__" title="Permalink to this definition">Â¶</a></dt>
<dd><p>list of weak references to the object (if defined)</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.get_channel_locations">
<code class="sig-name descname">get_channel_locations</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">feature</span></em>, <em class="sig-param"><span class="n">track</span></em>, <em class="sig-param"><span class="n">depths</span><span class="o">=</span><span class="default_value">None</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_channel_locations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_channel_locations" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Gets 3d coordinates from a depth along the electrophysiology feature. 2 steps
1) interpolate from the electrophys features depths space to the probe depth space
2) interpolate from the probe depth space to the true 3D coordinates
if depths is not provided, defaults to channels local coordinates depths</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.get_brain_locations">
<code class="sig-name descname">get_brain_locations</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">xyz_channels</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_brain_locations"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_brain_locations" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Finds the brain regions from 3D coordinates of electrode locations
:param xyz_channels: 3D coordinates of electrodes on probe
:type xyz_channels: np.array((n_elec, 3)) n_elec: no. of electrodes (384)
:return brain_regions: brain region object for each electrode
:type dict</p>
</dd></dl>

<dl class="py method">
<dt id="ibllib.pipes.ephys_alignment.EphysAlignment.get_perp_vector">
<code class="sig-name descname">get_perp_vector</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">feature</span></em>, <em class="sig-param"><span class="n">track</span></em><span class="sig-paren">)</span><a class="reference internal" href="../_modules/ibllib/pipes/ephys_alignment.html#EphysAlignment.get_perp_vector"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#ibllib.pipes.ephys_alignment.EphysAlignment.get_perp_vector" title="Permalink to this definition">Â¶</a></dt>
<dd><p>Finds the perpendicular vector along the trajectory at the depth of reference lines
:param feature: reference coordinates in feature space (ephys plots)
:type feature: np.array((n_lines + 2)) n_lines: no. of user reference lines
:param track: reference coordinates in track space (histology track)
:type track: np.array((n_line+2))
:return slice_lines: coordinates of perpendicular lines
:type slice_lines: np.array((n_lines, 2))</p>
</dd></dl>

</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="ibllib.pipes.ephys_preprocessing.html" class="btn btn-neutral float-right" title="ibllib.pipes.ephys_preprocessing" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="ibllib.pipes.html" class="btn btn-neutral float-left" title="ibllib.pipes" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, International Brain Laboratory

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>