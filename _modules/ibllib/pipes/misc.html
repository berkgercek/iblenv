

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>ibllib.pipes.misc &mdash; IBL Library  documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/copybutton.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/css/style.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
        <script src="../../../_static/clipboard.min.js"></script>
        <script src="../../../_static/copybutton.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> IBL Library
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../../01_overview.html">IBL data structure</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../02_installation.html">Installation</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../03_one.html">ONE</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../04_datajoint.html">Datajoint</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../05_tutorials.html">Tutorials</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../06_examples.html">Examples</a></li>
</ul>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../07_developers.html">API Reference</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">IBL Library</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>ibllib.pipes.misc</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for ibllib.pipes.misc</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">shutil</span>
<span class="kn">from</span> <span class="nn">pathlib</span> <span class="kn">import</span> <span class="n">Path</span>

<span class="kn">import</span> <span class="nn">alf.folders</span> <span class="k">as</span> <span class="nn">folders</span>
<span class="kn">from</span> <span class="nn">alf.io</span> <span class="kn">import</span> <span class="n">is_uuid_string</span>
<span class="kn">import</span> <span class="nn">ibllib.io.flags</span> <span class="k">as</span> <span class="nn">flags</span>
<span class="kn">import</span> <span class="nn">ibllib.io.params</span> <span class="k">as</span> <span class="nn">params</span>
<span class="kn">import</span> <span class="nn">ibllib.io.spikeglx</span> <span class="k">as</span> <span class="nn">spikeglx</span>
<span class="kn">from</span> <span class="nn">oneibl.one</span> <span class="kn">import</span> <span class="n">ONE</span>


<div class="viewcode-block" id="cli_ask_default"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.cli_ask_default">[docs]</a><span class="k">def</span> <span class="nf">cli_ask_default</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">default</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">dflt</span> <span class="o">=</span> <span class="s2">&quot; [default: </span><span class="si">{}</span><span class="s2">]: &quot;</span>
    <span class="n">dflt</span> <span class="o">=</span> <span class="n">dflt</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">default</span><span class="p">)</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span> <span class="o">+</span> <span class="n">dflt</span><span class="p">)</span> <span class="ow">or</span> <span class="n">default</span>
    <span class="k">return</span> <span class="n">ans</span></div>


<div class="viewcode-block" id="cli_ask_options"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.cli_ask_options">[docs]</a><span class="k">def</span> <span class="nf">cli_ask_options</span><span class="p">(</span><span class="n">prompt</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">options</span><span class="p">:</span> <span class="nb">list</span><span class="p">,</span> <span class="n">default_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="n">parsed_options</span> <span class="o">=</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">options</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">default_idx</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">parsed_options</span><span class="p">[</span><span class="n">default_idx</span><span class="p">]</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="n">parsed_options</span><span class="p">[</span><span class="n">default_idx</span><span class="p">]</span><span class="si">}</span><span class="s2">]&quot;</span>
    <span class="n">options_str</span> <span class="o">=</span> <span class="s1">&#39; (&#39;</span> <span class="o">+</span> <span class="s1">&#39; | &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">parsed_options</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;)&gt; &#39;</span>
    <span class="n">ans</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">prompt</span> <span class="o">+</span> <span class="n">options_str</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">str</span><span class="p">(</span><span class="n">options</span><span class="p">[</span><span class="n">default_idx</span><span class="p">])</span>
    <span class="k">if</span> <span class="n">ans</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">options</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">cli_ask_options</span><span class="p">(</span><span class="n">prompt</span><span class="p">,</span> <span class="n">options</span><span class="p">,</span> <span class="n">default_idx</span><span class="o">=</span><span class="n">default_idx</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ans</span></div>


<div class="viewcode-block" id="behavior_exists"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.behavior_exists">[docs]</a><span class="k">def</span> <span class="nf">behavior_exists</span><span class="p">(</span><span class="n">session_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>  <span class="c1"># testOK</span>
    <span class="n">session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session_path</span><span class="p">)</span>
    <span class="n">behavior_path</span> <span class="o">=</span> <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_behavior_data&#39;</span>
    <span class="k">if</span> <span class="n">behavior_path</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">True</span>
    <span class="k">return</span> <span class="kc">False</span></div>


<div class="viewcode-block" id="check_transfer"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.check_transfer">[docs]</a><span class="k">def</span> <span class="nf">check_transfer</span><span class="p">(</span><span class="n">src_session_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">dst_session_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="c1"># missing fail test</span>
    <span class="n">src_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">src_session_path</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_file</span><span class="p">()])</span>
    <span class="n">dst_files</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">dst_session_path</span><span class="p">)</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_file</span><span class="p">()])</span>
    <span class="n">assert_msg</span> <span class="o">=</span> <span class="s1">&#39;src_files != dst_files&#39;</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">src_files</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">dst_files</span><span class="p">),</span> <span class="n">assert_msg</span>
    <span class="k">for</span> <span class="n">s</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">src_files</span><span class="p">,</span> <span class="n">dst_files</span><span class="p">):</span>
        <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">name</span> <span class="o">==</span> <span class="n">d</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">assert_msg</span>
        <span class="k">assert</span> <span class="n">s</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span> <span class="o">==</span> <span class="n">d</span><span class="o">.</span><span class="n">stat</span><span class="p">()</span><span class="o">.</span><span class="n">st_size</span><span class="p">,</span> <span class="n">assert_msg</span></div>


<div class="viewcode-block" id="rename_session"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.rename_session">[docs]</a><span class="k">def</span> <span class="nf">rename_session</span><span class="p">(</span><span class="n">session_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Path</span><span class="p">:</span>
    <span class="n">session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">folders</span><span class="o">.</span><span class="n">session_path</span><span class="p">(</span><span class="n">session_path</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">session_path</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">return</span>
    <span class="n">mouse</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">]</span>
    <span class="n">date</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span>
    <span class="n">sess</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">new_mouse</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Please insert mouse NAME [current value: </span><span class="si">{</span><span class="n">mouse</span><span class="si">}</span><span class="s2">]&gt; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">mouse</span>
    <span class="n">new_date</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Please insert new session DATE [current value: </span><span class="si">{</span><span class="n">date</span><span class="si">}</span><span class="s2">]&gt; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">date</span>
    <span class="n">new_sess</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span>
        <span class="sa">f</span><span class="s2">&quot;Please insert new session NUMBER [current value: </span><span class="si">{</span><span class="n">sess</span><span class="si">}</span><span class="s2">]&gt; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="n">sess</span>
    <span class="n">new_session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="o">*</span><span class="n">session_path</span><span class="o">.</span><span class="n">parts</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span> <span class="o">/</span> <span class="n">new_mouse</span> <span class="o">/</span> <span class="n">new_date</span> <span class="o">/</span> <span class="n">new_sess</span>

    <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">session_path</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_session_path</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">session_path</span><span class="p">,</span> <span class="s1">&#39;--&gt; renamed to:&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">new_session_path</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">new_session_path</span></div>


<div class="viewcode-block" id="transfer_folder"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.transfer_folder">[docs]</a><span class="k">def</span> <span class="nf">transfer_folder</span><span class="p">(</span><span class="n">src</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">dst</span><span class="p">:</span> <span class="n">Path</span><span class="p">,</span> <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Attempting to copy:</span><span class="se">\n</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="se">\n</span><span class="s2">--&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removing </span><span class="si">{</span><span class="n">dst</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">rmtree</span><span class="p">(</span><span class="n">dst</span><span class="p">,</span> <span class="n">ignore_errors</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Copying all files:</span><span class="se">\n</span><span class="si">{</span><span class="n">src</span><span class="si">}</span><span class="se">\n</span><span class="s2">--&gt; </span><span class="si">{</span><span class="n">dst</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="n">shutil</span><span class="o">.</span><span class="n">copytree</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span>
    <span class="c1"># If folder was created delete the src_flag_file</span>
    <span class="k">if</span> <span class="n">check_transfer</span><span class="p">(</span><span class="n">src</span><span class="p">,</span> <span class="n">dst</span><span class="p">)</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;All files copied&quot;</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_params_dict"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.load_params_dict">[docs]</a><span class="k">def</span> <span class="nf">load_params_dict</span><span class="p">(</span><span class="n">params_fname</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
    <span class="n">params_fpath</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="n">params_fname</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">params_fpath</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="k">return</span> <span class="kc">None</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">params_fpath</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">out</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="load_videopc_params"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.load_videopc_params">[docs]</a><span class="k">def</span> <span class="nf">load_videopc_params</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">load_params_dict</span><span class="p">(</span><span class="s1">&#39;videopc_params&#39;</span><span class="p">):</span>
        <span class="n">create_videopc_params</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">load_params_dict</span><span class="p">(</span><span class="s1">&#39;videopc_params&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="load_ephyspc_params"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.load_ephyspc_params">[docs]</a><span class="k">def</span> <span class="nf">load_ephyspc_params</span><span class="p">():</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">load_params_dict</span><span class="p">(</span><span class="s1">&#39;ephyspc_params&#39;</span><span class="p">):</span>
        <span class="n">create_ephyspc_params</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">load_params_dict</span><span class="p">(</span><span class="s1">&#39;ephyspc_params&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="create_videopc_params"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.create_videopc_params">[docs]</a><span class="k">def</span> <span class="nf">create_videopc_params</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="s1">&#39;videopc_params&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="s1">&#39;videopc_params&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> exists already, exiting...&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="s1">&#39;videopc_params&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
        <span class="n">data_folder_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\iblrig_data\Subjects&quot;</span>
        <span class="n">remote_data_folder_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">iblserver.champalimaud.pt\ibldata\Subjects&quot;</span>
        <span class="n">body_cam_idx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">left_cam_idx</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">right_cam_idx</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_folder_path</span> <span class="o">=</span> <span class="n">cli_ask_default</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;Where&#39;s your LOCAL &#39;Subjects&#39; data folder?&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;D:\iblrig_data\Subjects&quot;</span><span class="p">)</span>
        <span class="n">remote_data_folder_path</span> <span class="o">=</span> <span class="n">cli_ask_default</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;Where&#39;s your REMOTE &#39;Subjects&#39; data folder?&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">iblserver.champalimaud.pt\ibldata\Subjects&quot;</span><span class="p">)</span>
        <span class="n">body_cam_idx</span> <span class="o">=</span> <span class="n">cli_ask_default</span><span class="p">(</span><span class="s2">&quot;Please select the index of the BODY camera&quot;</span><span class="p">,</span> <span class="s1">&#39;0&#39;</span><span class="p">)</span>
        <span class="n">left_cam_idx</span> <span class="o">=</span> <span class="n">cli_ask_default</span><span class="p">(</span><span class="s2">&quot;Please select the index of the LEFT camera&quot;</span><span class="p">,</span> <span class="s1">&#39;1&#39;</span><span class="p">)</span>
        <span class="n">right_cam_idx</span> <span class="o">=</span> <span class="n">cli_ask_default</span><span class="p">(</span><span class="s2">&quot;Please select the index of the RIGHT camera&quot;</span><span class="p">,</span> <span class="s1">&#39;2&#39;</span><span class="p">)</span>

    <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;DATA_FOLDER_PATH&#39;</span><span class="p">:</span> <span class="n">data_folder_path</span><span class="p">,</span>
        <span class="s1">&#39;REMOTE_DATA_FOLDER_PATH&#39;</span><span class="p">:</span> <span class="n">remote_data_folder_path</span><span class="p">,</span>
        <span class="s1">&#39;BODY_CAM_IDX&#39;</span><span class="p">:</span> <span class="n">body_cam_idx</span><span class="p">,</span>
        <span class="s1">&#39;LEFT_CAM_IDX&#39;</span><span class="p">:</span> <span class="n">left_cam_idx</span><span class="p">,</span>
        <span class="s1">&#39;RIGHT_CAM_IDX&#39;</span><span class="p">:</span> <span class="n">right_cam_idx</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">params</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;videopc_params&#39;</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="s1">&#39;videopc_params&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">param_dict</span></div>


<div class="viewcode-block" id="create_ephyspc_params"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.create_ephyspc_params">[docs]</a><span class="k">def</span> <span class="nf">create_ephyspc_params</span><span class="p">(</span><span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">silent</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">Path</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="s1">&#39;ephyspc_params&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">force</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="s1">&#39;ephyspc_params&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2"> exists already, exiting...&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">params</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="s1">&#39;ephyspc_params&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">exists</span><span class="p">())</span>
        <span class="k">return</span>
    <span class="k">if</span> <span class="n">silent</span><span class="p">:</span>
        <span class="n">data_folder_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;D:\iblrig_data\Subjects&quot;</span>
        <span class="n">remote_data_folder_path</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">iblserver.champalimaud.pt\ibldata\Subjects&quot;</span>
        <span class="n">probe_type_00</span> <span class="o">=</span> <span class="s1">&#39;3A&#39;</span>
        <span class="n">probe_type_01</span> <span class="o">=</span> <span class="s1">&#39;3B&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">data_folder_path</span> <span class="o">=</span> <span class="n">cli_ask_default</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;Where&#39;s your LOCAL &#39;Subjects&#39; data folder?&quot;</span><span class="p">,</span> <span class="sa">r</span><span class="s2">&quot;D:\iblrig_data\Subjects&quot;</span><span class="p">)</span>
        <span class="n">remote_data_folder_path</span> <span class="o">=</span> <span class="n">cli_ask_default</span><span class="p">(</span>
            <span class="sa">r</span><span class="s2">&quot;Where&#39;s your REMOTE &#39;Subjects&#39; data folder?&quot;</span><span class="p">,</span>
            <span class="sa">r</span><span class="s2">&quot;</span><span class="se">\\</span><span class="s2">iblserver.champalimaud.pt\ibldata\Subjects&quot;</span><span class="p">)</span>
        <span class="n">probe_type_00</span> <span class="o">=</span> <span class="n">cli_ask_options</span><span class="p">(</span><span class="s2">&quot;What&#39;s the type of PROBE 00?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;3A&#39;</span><span class="p">,</span> <span class="s1">&#39;3B&#39;</span><span class="p">])</span>
        <span class="n">probe_type_01</span> <span class="o">=</span> <span class="n">cli_ask_options</span><span class="p">(</span><span class="s2">&quot;What&#39;s the type of PROBE 01?&quot;</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;3A&#39;</span><span class="p">,</span> <span class="s1">&#39;3B&#39;</span><span class="p">])</span>
    <span class="n">param_dict</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;DATA_FOLDER_PATH&#39;</span><span class="p">:</span> <span class="n">data_folder_path</span><span class="p">,</span>
        <span class="s1">&#39;REMOTE_DATA_FOLDER_PATH&#39;</span><span class="p">:</span> <span class="n">remote_data_folder_path</span><span class="p">,</span>
        <span class="s1">&#39;PROBE_TYPE_00&#39;</span><span class="p">:</span> <span class="n">probe_type_00</span><span class="p">,</span>
        <span class="s1">&#39;PROBE_TYPE_01&#39;</span><span class="p">:</span> <span class="n">probe_type_01</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">params</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="s1">&#39;ephyspc_params&#39;</span><span class="p">,</span> <span class="n">param_dict</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Created </span><span class="si">{</span><span class="n">params</span><span class="o">.</span><span class="n">getfile</span><span class="p">(</span><span class="s1">&#39;ephyspc_params&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">param_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">param_dict</span></div>


<div class="viewcode-block" id="confirm_video_remote_folder"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.confirm_video_remote_folder">[docs]</a><span class="k">def</span> <span class="nf">confirm_video_remote_folder</span><span class="p">(</span><span class="n">local_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">remote_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="n">load_videopc_params</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">local_folder</span><span class="p">:</span>
        <span class="n">local_folder</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;DATA_FOLDER_PATH&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">remote_folder</span><span class="p">:</span>
        <span class="n">remote_folder</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;REMOTE_DATA_FOLDER_PATH&#39;</span><span class="p">]</span>
    <span class="n">local_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_folder</span><span class="p">)</span>
    <span class="n">remote_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">remote_folder</span><span class="p">)</span>
    <span class="c1"># Check for Subjects folder</span>
    <span class="n">local_folder</span> <span class="o">=</span> <span class="n">folders</span><span class="o">.</span><span class="n">subjects_data_folder</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">rglob</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">remote_folder</span> <span class="o">=</span> <span class="n">folders</span><span class="o">.</span><span class="n">subjects_data_folder</span><span class="p">(</span><span class="n">remote_folder</span><span class="p">,</span> <span class="n">rglob</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LOCAL:&#39;</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;REMOTE:&#39;</span><span class="p">,</span> <span class="n">remote_folder</span><span class="p">)</span>
    <span class="n">src_session_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">parent</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_folder</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;transfer_me.flag&quot;</span><span class="p">)]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">src_session_paths</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to transfer, exiting...&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">session_path</span> <span class="ow">in</span> <span class="n">src_session_paths</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Found session: </span><span class="si">{</span><span class="n">session_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">flag_file</span> <span class="o">=</span> <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;transfer_me.flag&#39;</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Transfer to </span><span class="si">{</span><span class="n">remote_folder</span><span class="si">}</span><span class="s2"> with the same name?&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[y]es/[r]ename/[s]kip/[e]xit</span><span class="se">\n</span><span class="s2"> ^</span><span class="se">\n</span><span class="s2">&gt; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;y&#39;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;rename&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">confirm_video_remote_folder</span><span class="p">(</span>
                <span class="n">local_folder</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">remote_folder</span><span class="o">=</span><span class="n">remote_folder</span><span class="p">,</span> <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span> <span class="ow">or</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span> <span class="ow">or</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;rename&#39;</span><span class="p">:</span>
            <span class="n">session_path</span> <span class="o">=</span> <span class="n">rename_session</span><span class="p">(</span><span class="n">session_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span> <span class="ow">or</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span> <span class="ow">or</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;exit&#39;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">remote_session_path</span> <span class="o">=</span> <span class="n">remote_folder</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="o">*</span><span class="n">session_path</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">behavior_exists</span><span class="p">(</span><span class="n">remote_session_path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No behavior folder found in </span><span class="si">{</span><span class="n">remote_session_path</span><span class="si">}</span><span class="s2">: skipping session...&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="n">transfer_folder</span><span class="p">(</span>
            <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_video_data&#39;</span><span class="p">,</span>
            <span class="n">remote_session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_video_data&#39;</span><span class="p">,</span>
            <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="n">flag_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="n">create_video_transfer_done_flag</span><span class="p">(</span><span class="n">remote_session_path</span><span class="p">)</span>
        <span class="n">check_create_raw_session_flag</span><span class="p">(</span><span class="n">remote_session_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="confirm_ephys_remote_folder"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.confirm_ephys_remote_folder">[docs]</a><span class="k">def</span> <span class="nf">confirm_ephys_remote_folder</span><span class="p">(</span><span class="n">local_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">remote_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                                <span class="n">force</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">iblscripts_folder</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">pars</span> <span class="o">=</span> <span class="n">load_ephyspc_params</span><span class="p">()</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">local_folder</span><span class="p">:</span>
        <span class="n">local_folder</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;DATA_FOLDER_PATH&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">remote_folder</span><span class="p">:</span>
        <span class="n">remote_folder</span> <span class="o">=</span> <span class="n">pars</span><span class="p">[</span><span class="s1">&#39;REMOTE_DATA_FOLDER_PATH&#39;</span><span class="p">]</span>
    <span class="n">local_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">local_folder</span><span class="p">)</span>
    <span class="n">remote_folder</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">remote_folder</span><span class="p">)</span>
    <span class="c1"># Check for Subjects folder</span>
    <span class="n">local_folder</span> <span class="o">=</span> <span class="n">folders</span><span class="o">.</span><span class="n">subjects_data_folder</span><span class="p">(</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">rglob</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">remote_folder</span> <span class="o">=</span> <span class="n">folders</span><span class="o">.</span><span class="n">subjects_data_folder</span><span class="p">(</span><span class="n">remote_folder</span><span class="p">,</span> <span class="n">rglob</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;LOCAL:&#39;</span><span class="p">,</span> <span class="n">local_folder</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;REMOTE:&#39;</span><span class="p">,</span> <span class="n">remote_folder</span><span class="p">)</span>
    <span class="n">src_session_paths</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span><span class="o">.</span><span class="n">parent</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">local_folder</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s2">&quot;transfer_me.flag&quot;</span><span class="p">)]</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">src_session_paths</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Nothing to transfer, exiting...&quot;</span><span class="p">)</span>
        <span class="k">return</span>

    <span class="k">for</span> <span class="n">session_path</span> <span class="ow">in</span> <span class="n">src_session_paths</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Found session: </span><span class="si">{</span><span class="n">session_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="c1"># Rename ephys files</span>
        <span class="c1"># FIXME: if transfer has failed and wiring file is there renaming will fail!</span>
        <span class="n">rename_ephys_files</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">session_path</span><span class="p">))</span>
        <span class="c1"># Move ephys files</span>
        <span class="n">move_ephys_files</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">session_path</span><span class="p">))</span>
        <span class="c1"># Copy wiring files</span>
        <span class="n">copy_wiring_files</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">session_path</span><span class="p">),</span> <span class="n">iblscripts_folder</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">create_alyx_probe_insertions</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">session_path</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">BaseException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">e</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Creation failed, please create the probe insertions manually.&quot;</span><span class="p">,</span>
                  <span class="s2">&quot;Continuing transfer...&quot;</span><span class="p">)</span>
        <span class="n">msg</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Transfer to </span><span class="si">{</span><span class="n">remote_folder</span><span class="si">}</span><span class="s2"> with the same name?&quot;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="n">msg</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">[y]es/[r]ename/[s]kip/[e]xit</span><span class="se">\n</span><span class="s2"> ^</span><span class="se">\n</span><span class="s2">&gt; &quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="s1">&#39;y&#39;</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">resp</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">resp</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">resp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;yes&#39;</span><span class="p">,</span> <span class="s1">&#39;rename&#39;</span><span class="p">,</span> <span class="s1">&#39;skip&#39;</span><span class="p">,</span> <span class="s1">&#39;exit&#39;</span><span class="p">]:</span>
            <span class="k">return</span> <span class="n">confirm_ephys_remote_folder</span><span class="p">(</span>
                <span class="n">local_folder</span><span class="o">=</span><span class="n">local_folder</span><span class="p">,</span> <span class="n">remote_folder</span><span class="o">=</span><span class="n">remote_folder</span><span class="p">,</span>
                <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">,</span> <span class="n">iblscripts_folder</span><span class="o">=</span><span class="n">iblscripts_folder</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;y&#39;</span> <span class="ow">or</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;yes&#39;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;r&#39;</span> <span class="ow">or</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;rename&#39;</span><span class="p">:</span>
            <span class="n">session_path</span> <span class="o">=</span> <span class="n">rename_session</span><span class="p">(</span><span class="n">session_path</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;s&#39;</span> <span class="ow">or</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;skip&#39;</span><span class="p">:</span>
            <span class="k">continue</span>
        <span class="k">elif</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;e&#39;</span> <span class="ow">or</span> <span class="n">resp</span> <span class="o">==</span> <span class="s1">&#39;exit&#39;</span><span class="p">:</span>
            <span class="k">return</span>

        <span class="n">remote_session_path</span> <span class="o">=</span> <span class="n">remote_folder</span> <span class="o">/</span> <span class="n">Path</span><span class="p">(</span><span class="o">*</span><span class="n">session_path</span><span class="o">.</span><span class="n">parts</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">:])</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">behavior_exists</span><span class="p">(</span><span class="n">remote_session_path</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No behavior folder found in </span><span class="si">{</span><span class="n">remote_session_path</span><span class="si">}</span><span class="s2">: skipping session...&quot;</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="c1"># TODO: Check flagfiles on src.and dst + alf dir in session folder then remove</span>
        <span class="c1"># Try catch? wher catch condition is force transfer maybe</span>
        <span class="n">transfer_folder</span><span class="p">(</span>
            <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_ephys_data&#39;</span><span class="p">,</span>
            <span class="n">remote_session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_ephys_data&#39;</span><span class="p">,</span>
            <span class="n">force</span><span class="o">=</span><span class="n">force</span><span class="p">)</span>
        <span class="c1"># if behavior extract_me.flag exists remove it, because of ephys flag</span>
        <span class="n">flag_file</span> <span class="o">=</span> <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;transfer_me.flag&#39;</span>
        <span class="n">flag_file</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">remote_session_path</span> <span class="o">/</span> <span class="s1">&#39;extract_me.flag&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
            <span class="p">(</span><span class="n">remote_session_path</span> <span class="o">/</span> <span class="s1">&#39;extract_me.flag&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="c1"># Create remote flags</span>
        <span class="n">create_ephys_transfer_done_flag</span><span class="p">(</span><span class="n">remote_session_path</span><span class="p">)</span>
        <span class="n">check_create_raw_session_flag</span><span class="p">(</span><span class="n">remote_session_path</span><span class="p">)</span></div>


<div class="viewcode-block" id="create_alyx_probe_insertions"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.create_alyx_probe_insertions">[docs]</a><span class="k">def</span> <span class="nf">create_alyx_probe_insertions</span><span class="p">(</span><span class="n">session_path</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
                                 <span class="n">force</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
                                 <span class="n">one</span><span class="p">:</span> <span class="nb">object</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">model</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
                                 <span class="n">labels</span><span class="p">:</span> <span class="nb">list</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">one</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">one</span> <span class="o">=</span> <span class="n">ONE</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">is_uuid_string</span><span class="p">(</span><span class="n">session_path</span><span class="p">):</span>
        <span class="n">eid</span> <span class="o">=</span> <span class="n">session_path</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">eid</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">eid_from_path</span><span class="p">(</span><span class="n">session_path</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">eid</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Session not found on Alyx: please create session before creating insertions&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">model</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">probe_model</span> <span class="o">=</span> <span class="n">spikeglx</span><span class="o">.</span><span class="n">get_neuropixel_version_from_folder</span><span class="p">(</span><span class="n">session_path</span><span class="p">)</span>
        <span class="n">pmodel</span> <span class="o">=</span> <span class="s1">&#39;3B2&#39;</span> <span class="k">if</span> <span class="n">probe_model</span> <span class="o">==</span> <span class="s1">&#39;3B&#39;</span> <span class="k">else</span> <span class="n">probe_model</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">pmodel</span> <span class="o">=</span> <span class="n">model</span>
    <span class="n">raw_ephys_data_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session_path</span><span class="p">)</span> <span class="o">/</span> <span class="s1">&#39;raw_ephys_data&#39;</span>
    <span class="k">if</span> <span class="n">labels</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">probe_labels</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">Path</span><span class="p">(</span><span class="n">raw_ephys_data_path</span><span class="p">)</span><span class="o">.</span><span class="n">glob</span><span class="p">(</span><span class="s1">&#39;*&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">is_dir</span><span class="p">()</span> <span class="ow">and</span> <span class="p">(</span><span class="s1">&#39;00&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span> <span class="ow">or</span> <span class="s1">&#39;01&#39;</span> <span class="ow">in</span> <span class="n">x</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">probe_labels</span> <span class="o">=</span> <span class="n">labels</span>
    <span class="c1"># create the dictionary</span>
    <span class="k">for</span> <span class="n">plabel</span> <span class="ow">in</span> <span class="n">probe_labels</span><span class="p">:</span>
        <span class="n">insdict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;session&#39;</span><span class="p">:</span> <span class="n">eid</span><span class="p">,</span>
                   <span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">plabel</span><span class="p">,</span>
                   <span class="s1">&#39;model&#39;</span><span class="p">:</span> <span class="n">pmodel</span><span class="p">}</span>
        <span class="c1"># search for the corresponding insertion in Alyx</span>
        <span class="n">alyx_insertion</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;insertions&#39;</span><span class="p">,</span> <span class="s1">&#39;list&#39;</span><span class="p">,</span>
                                       <span class="n">session</span><span class="o">=</span><span class="n">insdict</span><span class="p">[</span><span class="s1">&#39;session&#39;</span><span class="p">],</span>
                                       <span class="n">name</span><span class="o">=</span><span class="n">insdict</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">])</span>
        <span class="c1"># if it doesn&#39;t exist, create it</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">alyx_insertion</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">alyx_insertion</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;insertions&#39;</span><span class="p">,</span> <span class="s1">&#39;create&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">insdict</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">iid</span> <span class="o">=</span> <span class="n">alyx_insertion</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s1">&#39;id&#39;</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">force</span><span class="p">:</span>
                <span class="n">alyx_insertion</span> <span class="o">=</span> <span class="n">one</span><span class="o">.</span><span class="n">alyx</span><span class="o">.</span><span class="n">rest</span><span class="p">(</span><span class="s1">&#39;insertions&#39;</span><span class="p">,</span> <span class="s1">&#39;update&#39;</span><span class="p">,</span> <span class="nb">id</span><span class="o">=</span><span class="n">iid</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">insdict</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">alyx_insertion</span> <span class="o">=</span> <span class="n">alyx_insertion</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span></div>


<div class="viewcode-block" id="create_ephys_flags"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.create_ephys_flags">[docs]</a><span class="k">def</span> <span class="nf">create_ephys_flags</span><span class="p">(</span><span class="n">session_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session_folder</span><span class="p">)</span>
    <span class="n">flags</span><span class="o">.</span><span class="n">write_flag_file</span><span class="p">(</span><span class="n">session_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;extract_ephys.flag&#39;</span><span class="p">))</span>
    <span class="n">flags</span><span class="o">.</span><span class="n">write_flag_file</span><span class="p">(</span><span class="n">session_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;raw_ephys_qc.flag&#39;</span><span class="p">))</span>
    <span class="n">probe00_path</span> <span class="o">=</span> <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_ephys_data&#39;</span> <span class="o">/</span> <span class="s1">&#39;probe00&#39;</span>
    <span class="n">probe01_path</span> <span class="o">=</span> <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_ephys_data&#39;</span> <span class="o">/</span> <span class="s1">&#39;probe01&#39;</span>
    <span class="n">flags</span><span class="o">.</span><span class="n">write_flag_file</span><span class="p">(</span><span class="n">probe00_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;spike_sorting.flag&#39;</span><span class="p">))</span>
    <span class="n">flags</span><span class="o">.</span><span class="n">write_flag_file</span><span class="p">(</span><span class="n">probe01_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;spike_sorting.flag&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="create_ephys_transfer_done_flag"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.create_ephys_transfer_done_flag">[docs]</a><span class="k">def</span> <span class="nf">create_ephys_transfer_done_flag</span><span class="p">(</span><span class="n">session_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session_folder</span><span class="p">)</span>
    <span class="n">flags</span><span class="o">.</span><span class="n">write_flag_file</span><span class="p">(</span><span class="n">session_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;ephys_data_transferred.flag&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="create_video_transfer_done_flag"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.create_video_transfer_done_flag">[docs]</a><span class="k">def</span> <span class="nf">create_video_transfer_done_flag</span><span class="p">(</span><span class="n">session_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session_folder</span><span class="p">)</span>
    <span class="n">flags</span><span class="o">.</span><span class="n">write_flag_file</span><span class="p">(</span><span class="n">session_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;video_data_transferred.flag&#39;</span><span class="p">))</span></div>


<div class="viewcode-block" id="check_create_raw_session_flag"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.check_create_raw_session_flag">[docs]</a><span class="k">def</span> <span class="nf">check_create_raw_session_flag</span><span class="p">(</span><span class="n">session_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="n">session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session_folder</span><span class="p">)</span>
    <span class="n">ephys</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;ephys_data_transferred.flag&#39;</span><span class="p">)</span>
    <span class="n">video</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;video_data_transferred.flag&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ephys</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="ow">and</span> <span class="n">video</span><span class="o">.</span><span class="n">exists</span><span class="p">():</span>
        <span class="n">flags</span><span class="o">.</span><span class="n">write_flag_file</span><span class="p">(</span><span class="n">session_path</span><span class="o">.</span><span class="n">joinpath</span><span class="p">(</span><span class="s1">&#39;raw_session.flag&#39;</span><span class="p">))</span>
        <span class="n">ephys</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span>
        <span class="n">video</span><span class="o">.</span><span class="n">unlink</span><span class="p">()</span></div>


<div class="viewcode-block" id="rename_ephys_files"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.rename_ephys_files">[docs]</a><span class="k">def</span> <span class="nf">rename_ephys_files</span><span class="p">(</span><span class="n">session_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;rename_ephys_files is system agnostic (3A, 3B1, 3B2).</span>
<span class="sd">    Renames all ephys files to Alyx compatible filenames. Uses get_new_filename.</span>

<span class="sd">    :param session_folder: Session folder path</span>
<span class="sd">    :type session_folder: str</span>
<span class="sd">    :return: None - Changes names of files on filesystem</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session_folder</span><span class="p">)</span>
    <span class="n">ap_files</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.ap.*&#39;</span><span class="p">)</span>
    <span class="n">lf_files</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.lf.*&#39;</span><span class="p">)</span>
    <span class="n">nidq_files</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.nidq.*&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">apf</span> <span class="ow">in</span> <span class="n">ap_files</span><span class="p">:</span>
        <span class="n">new_filename</span> <span class="o">=</span> <span class="n">get_new_filename</span><span class="p">(</span><span class="n">apf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">apf</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">apf</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">new_filename</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">lff</span> <span class="ow">in</span> <span class="n">lf_files</span><span class="p">:</span>
        <span class="n">new_filename</span> <span class="o">=</span> <span class="n">get_new_filename</span><span class="p">(</span><span class="n">lff</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">lff</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">lff</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">new_filename</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">nidqf</span> <span class="ow">in</span> <span class="n">nidq_files</span><span class="p">:</span>
        <span class="n">new_filename</span> <span class="o">=</span> <span class="n">get_new_filename</span><span class="p">(</span><span class="n">nidqf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nidqf</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">nidqf</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="n">new_filename</span><span class="p">))</span></div>


<div class="viewcode-block" id="get_new_filename"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.get_new_filename">[docs]</a><span class="k">def</span> <span class="nf">get_new_filename</span><span class="p">(</span><span class="n">filename</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>  <span class="c1"># testOK</span>
    <span class="sd">&quot;&quot;&quot;get_new_filename is system agnostic (3A, 3B1, 3B2).</span>
<span class="sd">    Gets an alyx compatible filename from any spikeglx ephys file.</span>

<span class="sd">    :param filename: Name of an ephys file</span>
<span class="sd">    :type filename: str</span>
<span class="sd">    :return: New name for ephys file</span>
<span class="sd">    :rtype: str</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;_spikeglx_ephysData&#39;</span>
    <span class="c1"># gt = &#39;_g0_t0&#39; or &#39;error</span>
    <span class="n">gt</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">g</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s1">&#39;_g</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s1">_t</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
                <span class="n">gt</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;_g</span><span class="si">{</span><span class="n">g</span><span class="si">}</span><span class="s1">_t</span><span class="si">{</span><span class="n">t</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">gt</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">NotImplementedError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Can not parse </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2"> as an ephys file with gX_tY where&quot;</span>
                                      <span class="sa">f</span><span class="s2">&quot;XY are single digits&quot;</span><span class="p">)</span>

    <span class="c1"># ext = &#39;bin&#39; or &#39;meta&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;.bin&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;bin&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;.meta&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">ext</span> <span class="o">=</span> <span class="s1">&#39;meta&#39;</span>

    <span class="k">if</span> <span class="s1">&#39;.nidq.&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="k">return</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">root</span> <span class="o">+</span> <span class="n">gt</span><span class="p">,</span> <span class="s1">&#39;nidq&#39;</span><span class="p">,</span> <span class="n">ext</span><span class="p">])</span>

    <span class="c1"># probe = &#39;imec0&#39; or &#39;imec1&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;.imec0.&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">probe</span> <span class="o">=</span> <span class="s1">&#39;imec0&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;.imec1.&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">probe</span> <span class="o">=</span> <span class="s1">&#39;imec1&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;.imec.&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">probe</span> <span class="o">=</span> <span class="s1">&#39;imec&#39;</span>

    <span class="c1"># freq = &#39;ap&#39; or &#39;lf&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;.ap.&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;ap&#39;</span>
    <span class="k">elif</span> <span class="s1">&#39;.lf.&#39;</span> <span class="ow">in</span> <span class="n">filename</span><span class="p">:</span>
        <span class="n">freq</span> <span class="o">=</span> <span class="s1">&#39;lf&#39;</span>

    <span class="k">return</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">root</span> <span class="o">+</span> <span class="n">gt</span><span class="p">,</span> <span class="n">probe</span><span class="p">,</span> <span class="n">freq</span><span class="p">,</span> <span class="n">ext</span><span class="p">])</span></div>


<div class="viewcode-block" id="move_ephys_files"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.move_ephys_files">[docs]</a><span class="k">def</span> <span class="nf">move_ephys_files</span><span class="p">(</span><span class="n">session_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;move_ephys_files is system agnostic (3A, 3B1, 3B2).</span>
<span class="sd">    Moves all properly named ephys files to appropriate locations for transfer.</span>
<span class="sd">    Use rename_ephys_files function before this one.</span>

<span class="sd">    :param session_folder: Session folder path</span>
<span class="sd">    :type session_folder: str</span>
<span class="sd">    :return: None - Moves files on filesystem</span>
<span class="sd">    :rtype: None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session_folder</span><span class="p">)</span>
    <span class="n">raw_ephys_data_path</span> <span class="o">=</span> <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_ephys_data&#39;</span>

    <span class="n">probe00_path</span> <span class="o">=</span> <span class="n">raw_ephys_data_path</span> <span class="o">/</span> <span class="s1">&#39;probe00&#39;</span>
    <span class="n">probe01_path</span> <span class="o">=</span> <span class="n">raw_ephys_data_path</span> <span class="o">/</span> <span class="s1">&#39;probe01&#39;</span>
    <span class="c1"># 3A system imec only</span>
    <span class="n">imec_files</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.imec.*&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">imf</span> <span class="ow">in</span> <span class="n">imec_files</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;probe00&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">imf</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">imf</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">probe00_path</span> <span class="o">/</span> <span class="n">imf</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="k">elif</span> <span class="s1">&#39;probe01&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">imf</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">imf</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">probe01_path</span> <span class="o">/</span> <span class="n">imf</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="c1"># 3B system</span>
    <span class="n">imec0_files</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.imec0.*&#39;</span><span class="p">)</span>
    <span class="n">imec1_files</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.imec1.*&#39;</span><span class="p">)</span>
    <span class="n">nidq_files</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.nidq.*&#39;</span><span class="p">)</span>
    <span class="c1"># All imec 0 in probe00 folder</span>
    <span class="k">for</span> <span class="n">i0f</span> <span class="ow">in</span> <span class="n">imec0_files</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i0f</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">probe00_path</span> <span class="o">/</span> <span class="n">i0f</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="c1"># All imec 1 in probe01 folder</span>
    <span class="k">for</span> <span class="n">i1f</span> <span class="ow">in</span> <span class="n">imec1_files</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i1f</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">probe01_path</span> <span class="o">/</span> <span class="n">i1f</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="c1"># NIDAq files</span>
    <span class="n">nidq_files</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.nidq.*&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">nidqf</span> <span class="ow">in</span> <span class="n">nidq_files</span><span class="p">:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nidqf</span><span class="p">),</span> <span class="nb">str</span><span class="p">(</span><span class="n">raw_ephys_data_path</span> <span class="o">/</span> <span class="n">nidqf</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
    <span class="c1"># Delete all empty folders recursively</span>
    <span class="kn">from</span> <span class="nn">ibllib.io.misc</span> <span class="kn">import</span> <span class="n">delete_empty_folders</span>
    <span class="n">delete_empty_folders</span><span class="p">(</span><span class="n">raw_ephys_data_path</span><span class="p">,</span> <span class="n">dry</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></div>


<div class="viewcode-block" id="create_custom_ephys_wirings"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.create_custom_ephys_wirings">[docs]</a><span class="k">def</span> <span class="nf">create_custom_ephys_wirings</span><span class="p">(</span><span class="n">iblscripts_folder</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
    <span class="n">iblscripts_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">iblscripts_folder</span><span class="p">)</span>
    <span class="n">PARAMS</span> <span class="o">=</span> <span class="n">load_ephyspc_params</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;PROBE_TYPE_00&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;PROBE_TYPE_01&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Having different probe types not supported&quot;</span><span class="p">)</span>
        <span class="k">raise</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">)</span>

    <span class="n">params_path</span> <span class="o">=</span> <span class="n">iblscripts_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;iblscripts_params&#39;</span>
    <span class="n">params_path</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">parents</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">wirings_path</span> <span class="o">=</span> <span class="n">iblscripts_path</span> <span class="o">/</span> <span class="s1">&#39;deploy&#39;</span> <span class="o">/</span> <span class="s1">&#39;ephyspc&#39;</span> <span class="o">/</span> <span class="s1">&#39;wirings&#39;</span>
    <span class="k">if</span> <span class="s1">&#39;3A&#39;</span> <span class="ow">in</span> <span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;PROBE_TYPE_00&#39;</span><span class="p">]:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">wirings_path</span> <span class="o">/</span> <span class="s1">&#39;3A.wiring.json&#39;</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">params_path</span> <span class="o">/</span> <span class="s1">&#39;3A_probe00.wiring.json&#39;</span><span class="p">))</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">wirings_path</span> <span class="o">/</span> <span class="s1">&#39;3A.wiring.json&#39;</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">params_path</span> <span class="o">/</span> <span class="s1">&#39;3A_probe01.wiring.json&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Created 3A.wiring.json in </span><span class="si">{</span><span class="n">params_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s1">&#39;3B&#39;</span> <span class="ow">in</span> <span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;PROBE_TYPE_00&#39;</span><span class="p">]:</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">wirings_path</span> <span class="o">/</span> <span class="s1">&#39;3B.wiring.json&#39;</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">params_path</span> <span class="o">/</span> <span class="s1">&#39;3B_probe00.wiring.json&#39;</span><span class="p">))</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">wirings_path</span> <span class="o">/</span> <span class="s1">&#39;3B.wiring.json&#39;</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">params_path</span> <span class="o">/</span> <span class="s1">&#39;3B_probe01.wiring.json&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Created 3B.wiring.json in </span><span class="si">{</span><span class="n">params_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">wirings_path</span> <span class="o">/</span> <span class="s1">&#39;nidq.wiring.json&#39;</span><span class="p">),</span>
                    <span class="nb">str</span><span class="p">(</span><span class="n">params_path</span> <span class="o">/</span> <span class="s1">&#39;nidq.wiring.json&#39;</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Created nidq.wiring.json in </span><span class="si">{</span><span class="n">params_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">You can now modify your wirings files from folder </span><span class="si">{</span><span class="n">params_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_iblscripts_folder"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.get_iblscripts_folder">[docs]</a><span class="k">def</span> <span class="nf">get_iblscripts_folder</span><span class="p">():</span>
    <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">()</span><span class="o">.</span><span class="n">cwd</span><span class="p">()</span><span class="o">.</span><span class="n">parent</span><span class="o">.</span><span class="n">parent</span><span class="p">)</span></div>


<div class="viewcode-block" id="copy_wiring_files"><a class="viewcode-back" href="../../../_autosummary/ibllib.pipes.misc.html#ibllib.pipes.misc.copy_wiring_files">[docs]</a><span class="k">def</span> <span class="nf">copy_wiring_files</span><span class="p">(</span><span class="n">session_folder</span><span class="p">,</span> <span class="n">iblscripts_folder</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Run after moving files to probe folders&quot;&quot;&quot;</span>
    <span class="n">PARAMS</span> <span class="o">=</span> <span class="n">load_ephyspc_params</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;PROBE_TYPE_00&#39;</span><span class="p">]</span> <span class="o">!=</span> <span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;PROBE_TYPE_01&#39;</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Having different probe types is not supported&quot;</span><span class="p">)</span>
        <span class="k">raise</span><span class="p">(</span><span class="ne">NotImplementedError</span><span class="p">)</span>
    <span class="n">session_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">session_folder</span><span class="p">)</span>
    <span class="n">iblscripts_path</span> <span class="o">=</span> <span class="n">Path</span><span class="p">(</span><span class="n">iblscripts_folder</span><span class="p">)</span>
    <span class="n">iblscripts_params_path</span> <span class="o">=</span> <span class="n">iblscripts_path</span><span class="o">.</span><span class="n">parent</span> <span class="o">/</span> <span class="s1">&#39;iblscripts_params&#39;</span>
    <span class="n">wirings_path</span> <span class="o">=</span> <span class="n">iblscripts_path</span> <span class="o">/</span> <span class="s1">&#39;deploy&#39;</span> <span class="o">/</span> <span class="s1">&#39;ephyspc&#39;</span> <span class="o">/</span> <span class="s1">&#39;wirings&#39;</span>
    <span class="n">probe00_path</span> <span class="o">=</span> <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_ephys_data&#39;</span> <span class="o">/</span> <span class="s1">&#39;probe00&#39;</span>
    <span class="n">probe01_path</span> <span class="o">=</span> <span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_ephys_data&#39;</span> <span class="o">/</span> <span class="s1">&#39;probe01&#39;</span>
    <span class="n">termination</span> <span class="o">=</span> <span class="s1">&#39;.wiring.json&#39;</span>
    <span class="c1"># Determine if custom wiring applies</span>
    <span class="n">custom</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="n">iblscripts_params_path</span><span class="o">.</span><span class="n">exists</span><span class="p">()</span> <span class="k">else</span> <span class="kc">False</span>
    <span class="c1"># Determine system</span>
    <span class="n">ephys_system</span> <span class="o">=</span> <span class="n">PARAMS</span><span class="p">[</span><span class="s1">&#39;PROBE_TYPE_00&#39;</span><span class="p">]</span>
    <span class="c1"># Define where to get the files from</span>
    <span class="k">if</span> <span class="n">custom</span><span class="p">:</span>
        <span class="n">src_wiring_path</span> <span class="o">=</span> <span class="n">iblscripts_params_path</span>
        <span class="n">probe00_wiring_file_path</span> <span class="o">=</span> <span class="n">src_wiring_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ephys_system</span><span class="si">}</span><span class="s1">_probe00.wiring.json&#39;</span>
        <span class="n">probe01_wiring_file_path</span> <span class="o">=</span> <span class="n">src_wiring_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ephys_system</span><span class="si">}</span><span class="s1">_probe01.wiring.json&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">src_wiring_path</span> <span class="o">=</span> <span class="n">wirings_path</span>
        <span class="n">probe00_wiring_file_path</span> <span class="o">=</span> <span class="n">src_wiring_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ephys_system</span><span class="si">}</span><span class="s1">.wiring.json&#39;</span>
        <span class="n">probe01_wiring_file_path</span> <span class="o">=</span> <span class="n">src_wiring_path</span> <span class="o">/</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">ephys_system</span><span class="si">}</span><span class="s1">.wiring.json&#39;</span>

    <span class="k">if</span> <span class="n">ephys_system</span> <span class="o">==</span> <span class="s1">&#39;3B&#39;</span><span class="p">:</span>
        <span class="c1"># Copy nidq file</span>
        <span class="n">nidq_files</span> <span class="o">=</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.nidq.bin&#39;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">nidqf</span> <span class="ow">in</span> <span class="n">nidq_files</span><span class="p">:</span>
            <span class="n">nidq_wiring_name</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">nidqf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">termination</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">src_wiring_path</span> <span class="o">/</span> <span class="s1">&#39;nidq.wiring.json&#39;</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">session_path</span> <span class="o">/</span> <span class="s1">&#39;raw_ephys_data&#39;</span> <span class="o">/</span> <span class="n">nidq_wiring_name</span><span class="p">))</span>
    <span class="c1"># If system is either (3A OR 3B) copy a wiring file for each ap.bin file</span>
    <span class="k">for</span> <span class="n">binf</span> <span class="ow">in</span> <span class="n">session_path</span><span class="o">.</span><span class="n">rglob</span><span class="p">(</span><span class="s1">&#39;*.ap.bin&#39;</span><span class="p">):</span>
        <span class="n">wiring_name</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">binf</span><span class="o">.</span><span class="n">name</span><span class="p">)</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;.&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span> <span class="o">+</span> <span class="n">termination</span>
        <span class="k">if</span> <span class="s1">&#39;probe00&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">binf</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">probe00_wiring_file_path</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">probe00_path</span> <span class="o">/</span> <span class="n">wiring_name</span><span class="p">))</span>
        <span class="k">if</span> <span class="s1">&#39;probe01&#39;</span> <span class="ow">in</span> <span class="nb">str</span><span class="p">(</span><span class="n">binf</span><span class="p">):</span>
            <span class="n">shutil</span><span class="o">.</span><span class="n">copy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">probe01_wiring_file_path</span><span class="p">),</span>
                        <span class="nb">str</span><span class="p">(</span><span class="n">probe01_path</span> <span class="o">/</span> <span class="n">wiring_name</span><span class="p">))</span></div>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2020, International Brain Laboratory

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>